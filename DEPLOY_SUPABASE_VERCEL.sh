#!/bin/bash

# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘  ğŸš€ DÃ‰PLOIEMENT SUPABASE + VERCEL (100% GRATUIT)          â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "  GitHub Security Scraper - DÃ©ploiement Production"
echo "  Architecture : Supabase (Worker) + Vercel (Dashboard)"
echo "  CoÃ»t : \$0/mois"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ“± Ã‰TAPE 1 : TESTER TELEGRAM
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

echo "1ï¸âƒ£  Test Telegram..."
echo ""
echo "ExÃ©cutez :"
echo "  npm run test-telegram"
echo ""
echo "âœ… Vous devriez recevoir 2 messages sur Telegram"
echo ""
read -p "Appuyez sur EntrÃ©e une fois Telegram testÃ©..."

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸš€ Ã‰TAPE 2 : DÃ‰PLOYER SUR SUPABASE
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

echo ""
echo "2ï¸âƒ£  DÃ©ploiement Supabase (Worker)..."
echo ""
echo "ExÃ©cutez ces commandes :"
echo ""
echo "  # Login"
echo "  supabase login"
echo ""
echo "  # Link au projet"
echo "  supabase link --project-ref nykctocknzbstdqnfkun"
echo ""
echo "  # Configurer les secrets"
echo "  supabase secrets set GITHUB_TOKEN=ghp_VOTRE_TOKEN"
echo "  supabase secrets set TELEGRAM_BOT_TOKEN=VOTRE_BOT_TOKEN"
echo "  supabase secrets set TELEGRAM_CHAT_ID=VOTRE_CHAT_ID"
echo "  supabase secrets set TELEGRAM_NOTIFICATIONS=true"
echo ""
echo "  # DÃ©ployer"
echo "  supabase functions deploy scraper-worker"
echo ""
read -p "Appuyez sur EntrÃ©e une fois Supabase dÃ©ployÃ©..."

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# â° Ã‰TAPE 3 : CONFIGURER LE CRON
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

echo ""
echo "3ï¸âƒ£  Configuration Cron..."
echo ""
echo "Allez sur : https://supabase.com/dashboard/project/nykctocknzbstdqnfkun"
echo "SQL Editor â†’ Nouvelle query â†’ ExÃ©cuter ce SQL :"
echo ""
cat << 'SQL'
SELECT cron.schedule(
  'github-scraper',
  '*/15 * * * *',
  $$
  SELECT net.http_post(
    url := 'https://nykctocknzbstdqnfkun.supabase.co/functions/v1/scraper-worker',
    headers := '{"Content-Type": "application/json"}'::jsonb,
    body := '{}'::jsonb
  );
  $$
);
SQL
echo ""
read -p "Appuyez sur EntrÃ©e une fois le cron configurÃ©..."

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ¨ Ã‰TAPE 4 : DÃ‰PLOYER DASHBOARD SUR VERCEL
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

echo ""
echo "4ï¸âƒ£  DÃ©ploiement Dashboard sur Vercel..."
echo ""
echo "MÃ©thode CLI :"
echo "  cd ui"
echo "  vercel --prod"
echo ""
echo "MÃ©thode Dashboard :"
echo "  1. Aller sur https://vercel.com"
echo "  2. New Project â†’ Import repo"
echo "  3. Root Directory : ui/"
echo "  4. Deploy"
echo ""
read -p "Appuyez sur EntrÃ©e une fois Vercel dÃ©ployÃ©..."

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# âœ… VÃ‰RIFICATION
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "  âœ… DÃ‰PLOIEMENT TERMINÃ‰ !"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "ğŸ¯ VÃ©rifications :"
echo ""
echo "  1. Supabase Edge Function :"
echo "     https://nykctocknzbstdqnfkun.supabase.co/functions/v1/scraper-worker"
echo ""
echo "  2. Dashboard Vercel :"
echo "     https://votre-projet.vercel.app"
echo ""
echo "  3. Telegram :"
echo "     Attendre 15 min â†’ Recevoir notification de scan"
echo ""
echo "  4. Database :"
echo "     https://supabase.com/dashboard/project/nykctocknzbstdqnfkun"
echo "     Table: github_scan_history"
echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "  ğŸ‰ Le scraper tourne maintenant 24/7 gratuitement !"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
